<html><head>
<style type="text/css">
<!--
.just {text-align: justify;}
a {text-decoration: none}a:hover {text-decoration: underline; color: #504450}
BODY {
scrollbar-face-color:#808080;
scrollbar-highlight-color:#B8B4B8;s
scrollbar-3dlight-color:#808088;
scrollbar-darkshadow-color:#808088;
scrollbar-shadow-color:#B8B4B8;
scrollbar-arrow-color:#C0BCC0;
scrollbar-track-color:#E0E0E0;
}
-->
</style><title>Untitled Document</title>


<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!-- base -->
<link rel="icon" href="http://www.unidev.com.br/artigos/favicon.ico" type="image/ico"><link rel="SHORTCUT ICON" href="http://www.unidev.com.br/artigos/favicon.ico"><style type="text/css">
<!--
BODY {
scrollbar-face-color:#EAEEF4;
scrollbar-highlight-color:#FFFFFF;
scrollbar-3dlight-color:#EAEEF4;
scrollbar-darkshadow-color:#EAEEF4;
scrollbar-shadow-color:#9FB5D2;
scrollbar-arrow-color:#4D6185;
scrollbar-track-color:#F4F1EC;
}
-->
</style></head>


<body onload="" leftmargin="0" topmargin="0" alink="#504450" bgcolor="#000000" link="#504450" marginheight="0" marginwidth="0" text="#504450" vlink="#504450">

<script language="JavaScript">
<!--
function MM_openBrWindow(theURL,winName,features) { //v2.0
  window.open(theURL,winName,features);
}
//-->
</script>

<form action="../xp_autentica.asp" method="post">

<div align="center">
  <center>
  <table border="0" cellpadding="0" cellspacing="0" width="783">
    <tbody><tr>
      <td width="781">
  
  
	





<script language="JavaScript">
<!--
function MM_openBrWindow(theURL,winName,features) { //v2.0
  window.open(theURL,winName,features);
}
//-->
</script>
    <div align="center">
      <center>    
      <table style="border-collapse: collapse;" id="AutoNumber2" border="0" bordercolor="#234970" cellpadding="0" cellspacing="0" width="780">
      <tbody><tr>
        <td background="Radiosidade%20e%20Arvores%20BSP_files/barsuplogo.jpg" height="20"><b>
        <font face="Verdana" size="2">&nbsp;<font color="#ffffff">
        </font>
        <font color="#234970">Olá, deus.oke!&nbsp;</font>&nbsp;&nbsp;
        </font>
        <a href="http://www.unidev.com.br/logout.asp"><font color="#234970" face="verdana, arial, helvética" size="1">[logout]</font></a></b></td>
      </tr>
      <tr>
        <td background="Radiosidade%20e%20Arvores%20BSP_files/UDTOPBG.GIF" height="88" width="100%">
        <table style="border-collapse: collapse;" id="AutoNumber9" border="0" bordercolor="#234970" cellpadding="0" cellspacing="0" width="100%">
          <tbody><tr>
            <td width="25%">
            <a href="http://www.unidev.com.br/">
            <img src="Radiosidade%20e%20Arvores%20BSP_files/UDTITLE.JPG" border="0"></a></td>
            <td align="center" width="14%">
            <a href="http://www.unidev.com.br/">
            <img src="Radiosidade%20e%20Arvores%20BSP_files/logo_unidevBco1.gif" border="0" height="79" width="100"></a></td>
            <td width="100%">
            <iframe name="mainFrame" border="0" framespacing="0" src="Radiosidade%20e%20Arvores%20BSP_files/banner.htm" frameborder="0" height="68" width="400"></iframe>            
</td>
          </tr>
          <tr>
            <td colspan="3" width="100%">            <table style="border-collapse: collapse;" id="AutoNumber26" border="0" bordercolor="#111111" cellpadding="0" cellspacing="0" height="15" width="100%">
              <tbody><tr>
                <td bgcolor="#000000" height="15" width="50%">
      <center><b><font face="Verdana, arial, helvética" size="2">
      <a href="http://www.unidev.com.br/forum/topic.asp?TOPIC_ID=4321"><font color="#ffffff">comente sobre este artigo no fórum</font></a><font color="#ffffff">
      </font></font></b></center>

   </td>
                <td bgcolor="#000000" height="15" width="50%"><p align="center"><b><a href="javascript:MM_openBrWindow('../mailfriendart.asp?artigo=/artigos/radiosityonbsptree000.asp','','scrollbars=no,width=350,height=490')"><font color="#ffffff" face="verdana, arial, helvética" size="2">Indique
este artigo para um amigo</font></a></b></p></td>
              </tr>
            </tbody></table>
            </td>
          </tr>
              
        </tbody></table>
        </td>
      </tr>
    </tbody></table></center>
    </div>
      
      </td>
    </tr>
    <tr>
      <td valign="top" width="820">
  
  &nbsp;
      <div align="center">
        <center>
        <table border="0" cellpadding="0" cellspacing="0" width="97%">
        <tbody><tr>
          <td width="100%">
            <p align="center"><span class="title"><font color="#ffffff" face="Verdana" size="5"><b>Radiosidade 
            e Renderização de Árvores BSP</b></font></span><br>
            <span class="author"><font color="#ffffff" face="Verdana" size="2">por
            </font><b><a href="mailto:samme@starbreeze.com"><font color="#ffffff" face="Verdana" size="2">Samuel
            Ranta-Eskola</font></a><font color="#ffffff" face="Verdana" size="2"><br>
            </font></b><font color="#ffffff" face="Verdana" size="1">Traduzido
            por </font><a href="mailto:willianpolis@bol.com.br"><b>
            <font color="#ffffff" face="Verdana" size="1">Willian
            Polis</font></b></a></span></p><p align="justify"><font color="#ffffff" face="Verdana" size="2">Radiosidade
            é um modelo de iluminação normalmente usado em engines de jogos.
            A idéia original para radiosidade foi formulada por um grupo de
            escritores chamado Goral, Torrance, Battaile &amp; Greenberg[<b><a target="_blank" href="http://www.devmaster.net/articles/radiosity/#Reference">1</a></b>].
            Eles sugeriram que a radiosidade simularia a transferência de
            energia entre superfícies difusas. Estas superfícies são superfícies
            que refletem a luz igualmente em todas direções. O resultado de
            tal simulação daria um resultado de visão independente, o que
            significa que a iluminação na superfície pareceria a mesma em
            todos os ângulo de visão. Isto é muito utilizado em jogos 3D pois
            os cálculos só precisam ser executados uma única vez durante a pré
            renderização do mapa[</font><b><a target="_blank" href="#Reference"><font color="#ffffff" face="Verdana" size="2">2</font></a></b><font color="#ffffff" face="Verdana" size="2">].</font></p>
            <p align="justify"><font color="#ffffff" face="Verdana" size="2">Nós
            faremos um resumo de como o algoritmo de radiosidade funciona e
            focaremos em como a renderização de árvores BSP pode ser usada
            para otimizar os cálculos. Para adquirir mais conhecimento sobre o
            algoritmo, nós sugerimos que você leia uma leitura relacionada,
            indicada no final deste artigo.</font></p>
            <p align="justify"><font color="#ffffff" face="Verdana" size="2">O
            algoritmo de radiosidade é projetado de forma que a iluminação do
            cenário fique o mais natural possível. Se nós usássemos um
            modelo de iluminação direta, onde cada luz enviasse raio para o
            espaço e o iluminasse sem qualquer reflexão da luz, as sombras
            ficariam muito divididas e as coisas pareceriam estranhas, diferente
            do natural. Para usar o algoritmo de radiosidade, o espaço deve ser
            dividido em caminhos, onde cada caminho representa uma pequena parte
            do espaço. Cada um dos caminhos possui um nível inicial de
            energia, normalmente zero se ele não estiver emitindo luzes,
            iluminando paredes ou algo do tipo.</font></p>
            <p align="justify"><font color="#ffffff" face="Verdana" size="2">Existem
            diversas maneiras de distribuir energia em meio ao espaço. Nós
            escolhemos usar a interatividade chamada radiosidade. Isto significa
            que nós iniciamos enviando energia de um caminho com o nível mais
            alto de energia que está configurado como zero. Este processo é
            repetido até que não exista mias caminhos com tais níveis de
            energia.</font></p>
            <p align="justify"><font color="#ffffff" face="Verdana" size="2">Quando
            enviar energia de um caminho (j) para outro (i), a seguinte fórmula
            é usada:</font></p>
            <p align="justify"><b><font color="#ffffff" face="Courier New" size="2">B<sub>i</sub>
            = B<sub>i</sub> + B<sub>j</sub> * F<sub>ij</sub> * A<sub>i</sub> / A<sub>j</sub></font></b></p>
            <table align="center" width="92%">
              <tbody>
                <tr>
                  <td width="33%">
                    <p align="justify"><font color="#ffffff" face="Verdana" size="2"><b>B<sub>i</sub></b>
                    = o nível de energia do caminho i</font></p>
                  </td>
                  <td width="33%">
                    <p align="justify"><font color="#ffffff" face="Verdana" size="2"><b>B<sub>j</sub></b>
                    = o nível de energia do caminho j</font></p>
                  </td>
                  <td width="33%">
                    <p align="justify"><font color="#ffffff" face="Verdana" size="2"><b>F<sub>ij</sub></b>
                    = fator entre caminhos i e j (descritos posteriormente)</font></p>
                  </td>
                </tr>
                <tr>
                  <td width="33%">
                    <p align="justify"><font color="#ffffff" face="Verdana" size="2"><b>A<sub>i</sub></b>
                    = área do caminho i</font></p>
                  </td>
                  <td width="33%">
                    <p align="justify"><font color="#ffffff" face="Verdana" size="2"><b>A<sub>j</sub></b>
                    = área do caminho j</font></p>
                  </td>
                  <td width="33%">
                    <p align="justify"><font color="#ffffff" face="Verdana" size="2">&nbsp;</font></p>
                  </td>
                </tr>
              </tbody>
            </table>
            <p align="justify"><font color="#ffffff" face="Verdana" size="2">Na
            fórmula acima, o fator precisa de um descrição:</font></p>
            <p align="justify"><b><font color="#ffffff" face="Courier New" size="2">F<sub>ij</sub></font></b><font color="#ffffff" face="Courier New" size="2">
            = (cos &#952;i * cos &#952;j) / d<sup>2</sup> * <b>H<sub>ij</sub></b></font></p>
            <table align="center" width="75%">
              <tbody>
                <tr>
                  <td width="33%">
                    <p align="justify"><font color="#ffffff" face="Verdana" size="2"><b>F<sub>ij</sub></b>
                    = fator entre caminhos i e j</font></p>
                  </td>
                  <td>
                    <p align="justify"><font face="Verdana"><font color="#ffffff" size="2">&#952;<sub>i</sub>,
                    &#952;<sub>j</sub> = ângulos entre a normal do caminho e o
                    raio entre os caminhos</font></font></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p align="justify"><font color="#ffffff" face="Verdana" size="2"><b>d</b>
                    = distância entre os dois caminhos</font></p>
                  </td>
                  <td>
                    <p align="justify"><font color="#ffffff" face="Verdana" size="2"><b>H<sub>ij</sub></b>
                    = Visibilidade entre os dois caminhos. Se somente um raio
                    estiver traçado entre os dois caminhos, isto é 0 ou 1.
                    Normalmente, mais do que um raio é usado para melhorar
                    aproximações desde os caminhos que não são simples
                    pontos, mas sim áreas.</font></p>
                  </td>
                </tr>
              </tbody>
            </table>
            <p align="justify"><font color="#ffffff" face="Verdana" size="2">Como
            você pode ver acima, é extremamente difícil fazer os cálculos em
            um cenário. Está função é da ordem de O(n<sup>3</sup>) onde n
            é o número de caminhos no cenário. O <b>H</b> (visibilidade) do
            fator é a parta mais difícil de ser calculado e é aqui que nós
            podemos fazer uso das árvores BSP.</font></p>
            <h1 align="justify"><font color="#ffffff" face="Verdana" size="2">Radiosidade
            em Árvores BSP</font></h1>
            <p align="justify"><font color="#ffffff" face="Verdana" size="2">Antes
            da iluminação atual do cenário poder ser calculada, as superfícies
            precisam ser sub-divididas em caminhos. Uma idéia é que os
            caminhos são de um tamanho pré-determinado a partir do início e
            quando a energia é calculada em tal caminho, ele pode ser dividido
            em caminhos ainda menores, caso a energia varie muito. Devido a
            falta de tempo, nós descartamos esta idéia e continuamos no que nós
            achamos mais importante, chamado de árvore BSP para otimizar os cálculos.</font></p>
            <p align="justify"><font color="#ffffff" face="Verdana" size="2">Na
            idéia original da radiosidade, cada fonte de luz no cenário deve
            ser considerado como um de diversos caminhos. Nós preferimos fazer
            isto de uma outra forma. Cada fonte de luz é armazenado em uma
            Folha BSP. A primeira coisa que acontece é que a luz envia sua
            energia para todos os caminhos. Quando isto é feito, os cálculos
            de radiosidade podem ser finalizados e o cenário estará
            funcionando corretamente. Para fazer com que ele pareça ainda
            melhor, nós usamos uma técnica chamado de refinamento progressivo[</font><a href="#Reference"><font color="#ffffff" face="Verdana" size="2"><b>3</b></font></a><font color="#ffffff" face="Verdana" size="2">]
            de forma meramente modificada. Em cada interação do refinamento, o
            caminho com o nível mais alto de energia em cada uma das folhas irão
            refletir sua energia para todos os outros caminhos. Isto resultará
            no espalhamento da energia dos caminhos iluminados para os caminhos
            sombreados (escuros). Como na vida real, onde nada é realmente
            preto, tudo reflete a luz, seja esta reflexão em maior ou menor
            intensidade.</font></p>
            <p align="justify"><font color="#ffffff" face="Verdana" size="2">Devido
            a natureza árdua e difícil dos cálculos da radiosidade, nós
            precisamos fazer algumas otimizações. Usar o PVS que foi criado
            durante a renderização da árvore BSP quando escolher quais
            caminhos podem receber energia, pode economizar um monte de cálculos
            desnecessários. O raio traçado é executado da mesma forma que
            quando o PVS foi calculado.</font></p>
            <p align="justify"><font color="#ffffff" face="Verdana" size="2">Nossa
            versão do algoritmo para distribuição de energia através do cenário
            é como segue:</font></p>
            <div align="justify">
              <pre class="code"><font color="#ffffff" face="Courier New" size="2">RADIOSIDADE
* <i>Dados_de_Entrada</i>:
*   <b>Árvore</b> &#8211; Árvore na qual será aplicada a radiosidade
* <i>Dados_de_Saída</i>:
*   Nenhum
* <i>Efeito</i>:
*   Envia energia entre os caminhos no cenário.

RADIOSIDADE (Tree)
1 <b>para</b>(<b>cada</b> folha L <b>na</b> Árvore)
2 <b>    para</b>(<b>cada</b> luz S <b>no</b> L)
3 <b>        para</b>(<b>cada</b> folha V que está no <b>in</b> PVS do L)
4 <b>            </b>Envia energia do S para os caminhos em V

  // Neste estágio nós escolhemos fazer com que o designer possa, em qualquer ponto,
  // checar como o cenário está parecendo e brecar os envios de energia quando
  // ele achar que o cenário está bom o bastante
5 <b>enquanto</b>(<b>não</b> parece bom o bastante)
6 <b>    para</b>(<b>cada</b> folha L <b>na</b> Árvore)
7 <b>        para</b>(<b>cada</b> folha V que está <b>no</b> PVS do L)
8 <b>            </b>Envia energia do caminho com mais energia não-enviada em 
9             L para todos os caminhos em V.</font><font color="#ffffff" face="Verdana" size="2">
</font></pre>
            </div>
            <h2 align="justify"><font color="#ffffff" face="Verdana" size="2">Análise
            de Complexidade</font></h2>
            <p align="justify"><font color="#ffffff" face="Verdana" size="2">Este
            é um assassino real em custos computacionais. O pior caso é que
            cada raio precisa ser checado contra o polígono no cenário, que é
            de ordem O(n<sup>3</sup>) onde n é o número de caminhos na árvore.
            Felizmente, as otimizações nós temos feito na maioria dos casos,
            reduzem o custo, mas é quase impossível dizer quanto pois isto
            depende da estrutura da árvore.</font></p>
            <p align="justify"><font color="#ffffff" face="Verdana" size="2">Isto
            dá uma rápida iluminação de cenário onde as vantagens da árvore
            BSP entram em ação. Especialmente o trabalho feito durante o traçado
            do raio pode ser reduzido significantemente. O projetista do mapa
            pode decidir quando a renderização de um cenário é feita através
            de uma "quebra" do laço em qualquer momento para ver se o
            resultado está bom o bastante. É muito fácil trabalhar com a pré
            renderização do mapa várias vezes para ver aproximadamente como
            ele parecerá, ao invés de fazer renderização completa para cada
            mudança.</font></p>
            <p align="justify"><font color="#ffffff" face="Verdana" size="2">Abaixo
            está um screenshot de um exemplo de renderização feita com nosso
            algoritmo de radiosidade:</font></p>
            <p align="center" dir="ltr"><font color="#ffffff" face="Verdana" size="2">
            <img alt="Radiosity sample" src="Radiosidade%20e%20Arvores%20BSP_files/radiosity-bsp-1315image1.jpg" border="0"><br>
            <b>Figura 01:</b> Exemplo de Radiosidade</font></p>
            <p align="justify"><font color="#ffffff" face="Verdana" size="2">Acima
            está um exemplo de um cenário renderizado com nossa técnica. A
            parte esquerda da imagem está a versão não renderizada (ou pré
            renderizada); na direita o cenário foi renderizado com uma iluminação
            aproximada da câmera.</font></p>
            <h1 align="justify"><font color="#ffffff" face="Verdana" size="2">Resumo
            da Árvore de Renderização BSP</font></h1>
            <p align="justify"><font color="#ffffff" face="Verdana" size="2">Agora
            nós já descrevemos os passos que nós precisamos para completar a
            parte de pré-processamento de uma engine de BSP. O seguinte é o
            algoritmo para a renderização de um cenário em uma árvore BSP:</font></p>
            <div align="justify">
              <pre class="code"><font color="#ffffff" face="Courier New" size="2"> RENDERIZAÇÃO-CENÁRIO
* <i>Dados_de_Entrada</i>:
*   <b>Cenário</b> &#8211; O cenário para renderização como uma árvore BSP
* <i>Dados_de_Saída</i>:
*   Uma árvore BSP
* <i>Efeito</i>:
*   Renderiza uma árvore BSP fora da informação armazenada no cenário.

RENDERIZAÇÃO-CENÁRIO (Cenário)
   // Renderiza a árvore BSP usando os objetos que descrevem a geometria 
   // do cenário
1  Poligonos f {}
2  <b>para</b> (<b>cada</b> objeto O que pertence a geometria da cena)
3      Poligonos f Poligonos U O.DefinePoligono
4  GERAR-BSP-TREE (Árvore.NóRaiz, Poligonos)
   // Distribuir os pontos do exemplo em folhas da árvore.
5  DISTRIBUTE-SAMPLE-POINTS (Tree.NóRaiz, {})
6  TRAÇAR-VISIBILIDADE (Árvore)
7  <b>para (cada</b> objeto O que é um objeto estático na cena)
8      <b>para (cada</b> poligono P <b>em</b> O)
9          ENVIE-POLIGONO (Nó, P)
   // CREATE-PATCHES é uma função não definida que precisa de uma séria
   // consideração. Nossa solução para este problema não foi boa o bastante
   // e por isto nós escolhemos não apresentá-la.
10 CREATE-PATCHES (Árvore)
11 RADIOSIDADE (Árvore)</font><font color="#ffffff" face="Verdana" size="2">
</font></pre>
            </div>
            <h1 align="justify"><font color="#ffffff" face="Verdana" size="2">Leituras
            Relacionadas</font></h1>
            <ul style="color: rgb(255, 255, 255); font-family: Verdana;">
              <li>
                <p align="justify"><font color="#ffffff" face="Verdana" size="2">Saykol,
                Ediz and Kirimer, Burak. <i><b>Progressive Refinement of
                Radiosity</b></i></font></p></li><li>
                <p align="justify"><font color="#ffffff" face="Verdana" size="2">Teller,
                Seth. <i><b>Application Challenges to Computational Geometry</b></i></font></p></li><li>
                <p align="justify"><font color="#ffffff" face="Verdana" size="2">Firebaugh,
                M. <i><b>Three-Dimensional Graphics &#8211; Realistic Rendering</b></i></font></p></li><li>
                <p align="justify"><font color="#ffffff" face="Verdana" size="2">Nettle,
                Paul. <i><b>Radiosity in English</b></i></font></p></li><li>
                <p align="justify"><font color="#ffffff" face="Verdana" size="2">Nuydens,
                Tom. <i><b>3D Engine Column, Delphi3D</b></i></font>
            </p></li></ul>
            <h1 align="justify"><a name="Reference"><font color="#ffffff" face="Verdana" size="2">Referências</font></a></h1>
            <ol style="color: rgb(255, 255, 255); font-family: Verdana;">
              <li>
                <p align="justify"><font color="#ffffff" face="Verdana" size="2">Goral,
                Cindy M., Torrance, Kenneth E., Greenberg, Donald P., Battaile ,
                Bennett. <i><b>Modelando a interação da luz entre as superfícies
                difusas (Inglês)</b></i></font></p></li><li>
                <p align="justify"><font color="#ffffff" face="Verdana" size="2">Nettle,
                Paul. <i><b>Radiosidade (Inglês)</b></i></font></p></li><li>
                <p align="justify"><font color="#ffffff" face="Verdana" size="2">Nuydens,
                Tom. <i><b>3D Engine Column, Delphi3D</b></i></font>
            </p></li></ol>
          </td>
        </tr>
      </tbody></table>
      </center>
    </div>
      </td>
    </tr>
  </tbody></table>
</center></div>

<p align="center"><b><a href="javascript:MM_openBrWindow('../mailfriendart.asp?artigo=/artigos/radiosityonbsptree000.asp','','scrollbars=no,width=350,height=490')"><font color="#ffffff" face="verdana, arial, helvética" size="2">Indique
este artigo para um amigo</font></a></b></p>
</form></body></html>