if (self.CavalryLogger) { CavalryLogger.start_js(["Zt2iz"]); }

__d('EmojiInputDecorator',['EmojiRenderer','immutable'],(function a(b,c,d,e,f,g){'use strict';var h=c('immutable').List,i='.',j='emoji';function k(l,m,n){this.$EmojiInputDecorator1=l;this.$EmojiInputDecorator2=m;this.$EmojiInputDecorator3=n;}k.prototype.getDecorations=function(l,m){var n=this.$EmojiInputDecorator2?this.$EmojiInputDecorator2.getDecorations(l,m).toArray():Array(l.getText().length).fill(null),o=0;c('EmojiRenderer').parse(l.getText()).forEach(function(p){var q=p.offset,r=q+p.length,s=true;for(var t=q;t<r;t++)if(n[t]!=null){s=false;break;}if(s){for(var u=q;u<r;u++)n[u]=j+i+o;o++;}});return h(n);};k.prototype.getComponentForKey=function(l){if(!this.$EmojiInputDecorator2||l.split(i)[0]===j)return this.$EmojiInputDecorator1;return this.$EmojiInputDecorator2.getComponentForKey(l);};k.prototype.getPropsForKey=function(l){if(!this.$EmojiInputDecorator2||l.split(i)[0]===j)return this.$EmojiInputDecorator3;return this.$EmojiInputDecorator2.getPropsForKey(l);};f.exports=k;}),null);
__d('keyCommandBackspaceEmoji',['EditorState','EmojiRenderer','UnicodeUtils','moveSelectionBackward','removeTextWithStrategy'],(function a(b,c,d,e,f,g){var h=function i(j){var k=c('removeTextWithStrategy')(j,function(m){var n=m.getSelection(),o=n.getAnchorOffset(),p=m.getCurrentContent().getBlockForKey(n.getAnchorKey()).getText(),q=p[o-1],r=null;if(q){var s=c('EmojiRenderer').parse(p);for(var t=0;t<s.length;t++)if(s[t].offset<=o&&s[t].offset+s[t].length>=o){r=s[t].length;break;}if(!r)r=c('UnicodeUtils').getUTF16Length(q,0);}return c('moveSelectionBackward')(m,r||1);},'backward');if(k===j.getCurrentContent())return null;var l=j.getSelection();return c('EditorState').push(j,k.set('selectionBefore',l),l.isCollapsed()?'backspace-character':'remove-range');};f.exports=h;}),null);
__d('keyCommandDeleteEmoji',['EditorState','EmojiRenderer','UnicodeUtils','moveSelectionForward','removeTextWithStrategy'],(function a(b,c,d,e,f,g){var h=function i(j){var k=c('removeTextWithStrategy')(j,function(m){var n=m.getSelection(),o=n.getAnchorOffset(),p=m.getCurrentContent().getBlockForKey(n.getAnchorKey()).getText(),q=p[o],r=null;if(q){var s=c('EmojiRenderer').parse(p);for(var t=0;t<s.length;t++)if(s[t].offset<=o&&s[t].offset+s[t].length>=o){r=s[t].length;break;}if(!r)r=c('UnicodeUtils').getUTF16Length(q,0);}return c('moveSelectionForward')(m,r||1);},'forward');if(k===j.getCurrentContent())return null;var l=j.getSelection();return c('EditorState').push(j,k.set('selectionBefore',l),l.isCollapsed()?'delete-character':'remove-range');};f.exports=h;}),null);
__d('addEmojiInput',['EditorState','EmojiInputDecorator','EmojiSpan.react','React','keyCommandBackspaceEmoji','keyCommandDeleteEmoji'],(function a(b,c,d,e,f,g){'use strict';var h=function(i){return function(){var j,k;j=babelHelpers.inherits(l,c('React').Component);k=j&&j.prototype;function l(){var m,n;'use strict';for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];return n=(m=k.constructor).call.apply(m,[this].concat(p)),this.$_class1=function(r){var s=null;switch(r){case 'backspace':s=c('keyCommandBackspaceEmoji')(this.props.editorState);break;case 'delete':s=c('keyCommandDeleteEmoji')(this.props.editorState);break;}if(s){this.props.onChange(s);return 'handled';}return 'not-handled';}.bind(this),n;}l.prototype.blur=function(){'use strict';var m=this.refs.component;m&&typeof m.blur==='function'&&m.blur();};l.prototype.click=function(){'use strict';var m=this.refs.component;m&&typeof m.click==='function'&&m.click();};l.prototype.focus=function(){'use strict';var m=this.refs.component;m&&typeof m.focus==='function'&&m.focus();};l.prototype.render=function(){'use strict';var m=this.props.editorState,n=m.getDecorator();if(!(n instanceof c('EmojiInputDecorator')))m=c('EditorState').set(this.props.editorState,{decorator:new (c('EmojiInputDecorator'))(c('EmojiSpan.react'),n,{size:16})});return (c('React').createElement(i,babelHelpers['extends']({},this.props,{editorState:m,handleKeyCommand:this.$_class1,ref:'component'})));};return l;}();}.bind(this);f.exports=h;}),null);
__d('canUseReactEditor',['UserAgent'],(function a(b,c,d,e,f,g){'use strict';var h=typeof b.getSelection==='function',i=h&&(c('UserAgent').isPlatform('iOS')||c('UserAgent').isPlatform('Linux')||c('UserAgent').isPlatform('Mac OS X')||c('UserAgent').isPlatform('Windows')||c('UserAgent').isPlatform('Chrome OS'))&&(c('UserAgent').isEngine('EdgeHTML >= 12')||c('UserAgent').isEngine('Gecko >= 16')||c('UserAgent').isEngine('Trident >= 5')||c('UserAgent').isEngine('WebKit >= 533.16')&&!c('UserAgent').isBrowser('Mobile Safari < 6'));function j(){return i;}f.exports=j;}),null);
__d('UFIMentionsInput.react',['cx','Arbiter','BanzaiScuba','Bootloader','DraftEntity','DraftModifier','DOMVector','EditorState','EmojiConfig','EmojiFormat','Input','Keys','MentionsInput.react','React','ReactDOM','UFIUIEvents','URI','UFIConfig','addEmojiInput','canUseReactEditor','clickRefAction','createEditorStateWithEntities','createMentionEntity','emptyFunction','getMentionsInputDecorator','getMentionsTextForContentState','getVisibleValueForContentState','handleBeforeInputForEmoticon','handleSoftNewlineForEmoticon','isSoftNewlineEvent','setImmediate'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('EmojiConfig').hasFBEmojiInComposer,j=null;if(i){j=c('addEmojiInput')(c('MentionsInput.react'));}else j=c('MentionsInput.react');var k=new (c('BanzaiScuba'))('ufi_tinder',null,{addBrowserFields:true,addGeoFields:true,addPredictedGeographyFields:true,addMobileDeviceFields:true,addUser:true}),l=200,m='ufi_comment_composer',n='ufi_reply_composer',o=c('canUseReactEditor')(),p=c('React').PropTypes;function q(u){var v=u.map(function(w){return {kind:'file',type:w.type,getAsFile:c('emptyFunction').thatReturns(w)};});return {clipboardData:{items:v}};}function r(u){var v=/^image\//;return u.filter(function(w){return v.test(w.type);});}var s=c('React').createClass({displayName:'UFIMentionsInput',propTypes:{onContentChange:p.func,isBroadcasterUFI:p.bool},getInitialState:function u(){var v='',w=[];c('Arbiter').subscribe('Story/delete',function(y){this._clearDocumentState();}.bind(this));if(this.props.initialData){v=this.props.initialData.value||'';w=this.props.initialData.mentions||[];w=w.map(function(y){return babelHelpers['extends']({},y,{entity:{uid:y.uid,weakreference:y.weakreference}});});}var x=c('createEditorStateWithEntities')({text:v,ranges:w,decorator:c('getMentionsInputDecorator')(),entityCreationFn:t});x=c('EditorState').moveSelectionToEnd(x);return {bootloaded:false,fullRender:!!(this.props.initialData&&this.props.initialData.value),typeaheadReporter:null,editorState:x,mentionsSource:null,mentionableEntries:null,fallbackText:v};},hasEnteredText:function u(){return !!this.state.editorState.getCurrentContent().getPlainText().trim();},getText:function u(){var v=this.state.editorState.getCurrentContent();return c('getMentionsTextForContentState')(v);},focus:function u(){this._triggerFullRender(function(){if(o){this.refs.mentionsInput.focus();}else c('ReactDOM').findDOMNode(this.refs.textarea).focus();}.bind(this));},submitComment:function u(event){if(this._submitComment(event))this._clearDocumentState();},insertMention:function u(v){this._triggerFullRender(function(){if(o){var w=this.state.editorState,x=w.getSelection(),y=w.getCurrentContent(),z=x.getStartKey(),aa=x.getStartOffset(),ba=y.getBlockForKey(z),ca;if(ba.getText().substr(aa-1,1).trim().length>0){var da=c('DraftModifier').replaceText(y,x,' ');x=da.getSelectionAfter();ca=c('DraftModifier').insertText(da,x,v.getTitle(),w.getCurrentInlineStyle(),c('createMentionEntity')(v));}else ca=c('DraftModifier').replaceText(y,x,v.getTitle(),w.getCurrentInlineStyle(),c('createMentionEntity')(v));x=ca.getSelectionAfter();ca=c('DraftModifier').insertText(ca,x,' ');w=c('EditorState').push(w,ca,'insert-fragment');w=c('EditorState').forceSelection(w,w.getSelection());this.setState({editorState:w});this.focus();}else{c('ReactDOM').findDOMNode(this.refs.textarea).focus();if(this.state.fallbackText.length){this.setState({fallbackText:this.state.fallbackText+' '+v.title});}else this.setState({fallbackText:v.title});}}.bind(this));},insertEmoticon:function u(v){if(!o){this.setState({fallbackText:this.state.fallbackText+' '+v});return;}var w=this.state.editorState,x=w.getCurrentContent(),y=w.getSelection(),z=x.getBlockForKey(y.getStartKey()).getText()[y.getStartOffset()-1];if(z&&z!==' ')v=' '+v;var aa=x.getBlockForKey(y.getEndKey()).getText()[y.getEndOffset()];if(aa&&aa!==' ')v+=' ';var ba=c('DraftModifier').replaceText(w.getCurrentContent(),w.getSelection(),v);w=c('EditorState').push(w,ba,'insert-characters');w=c('EditorState').forceSelection(w,w.getSelection());this.setState({editorState:w});},insertEmoji:function u(v){var w=c('EmojiFormat').codeArrayToUnicode(v);if(!o){this.setState({fallbackText:this.state.fallbackText+' '+w});return;}this._onMentionsInputFocus();var x=this.state.editorState,y=c('DraftModifier').replaceText(x.getCurrentContent(),x.getSelection(),w),z=c('EditorState').push(x,y,'insert-characters');if(z!==this.state.editorState)this._onChange(c('EditorState').forceSelection(z,y.getSelectionAfter()));},_informHeightChange:function u(){if(this.props.monitorHeight)c('setImmediate')(function(){if(!this.isMounted())return;var v=o?c('ReactDOM').findDOMNode(this.refs.mentionsInput):c('ReactDOM').findDOMNode(this.refs.textarea),w=c('DOMVector').getElementDimensions(v).y;if(w!==this._height){this._height=w;c('Arbiter').inform(c('UFIUIEvents').InputHeightChanged,{node:v});}}.bind(this));},_onChange:function u(v){if(this.props.onContentChange){var w=this.state.editorState.getCurrentContent(),x=v.getCurrentContent();if(w!==x)this.props.onContentChange(c('getMentionsTextForContentState')(x));}this.setState({editorState:v},this._informHeightChange);},_clearDocumentState:function u(){this.state.typeaheadReporter&&this.state.typeaheadReporter.sessionEnd();var v=c('EditorState').createEmpty(c('getMentionsInputDecorator')());this.setState({editorState:c('EditorState').moveFocusToEnd(v)});},_handleContentReturn:function u(v){if(c('isSoftNewlineEvent')(v)){this.setState(function(w){var x=w.editorState;return {editorState:c('handleSoftNewlineForEmoticon')(x)};});return true;}v.persist();this.setState({},function(){if(this._submitComment(v))this._clearDocumentState();}.bind(this));return true;},_handleBeforeInput:function u(v){var w=c('handleBeforeInputForEmoticon')(this.state.editorState,v);if(w===this.state.editorState){return false;}else{this.setState({editorState:w});return true;}},_submitComment:function u(v){var w=this.state.editorState.getCurrentContent(),x=c('getVisibleValueForContentState')(w),y=c('getMentionsTextForContentState')(w),z={visibleValue:x,encodedValue:y},aa=c('Input').getValue(c('ReactDOM').findDOMNode(this.refs.proxyInput));if(aa){var ba=new (c('URI'))(b.location.href);k.addNormal('path',ba.getPath());k.addNormal('proxy_value',aa.substr(0,l));k.post();}return this.props.onEnterSubmit(z,v);},_handleFiles:function u(v){var w=r(v);if(w.length){this.props.onPaste(q(w));return true;}return false;},_handleDroppedFiles:function u(v,w){return this._handleFiles(w);},_handlePastedFiles:function u(v){return this._handleFiles(v);},_onMentionsInputBlur:function u(){this.state.typeaheadReporter&&this.state.typeaheadReporter.sessionEnd();this.props.onBlur&&this.props.onBlur();c('Arbiter').inform(c('UFIUIEvents').Blur,{ftEntIdentifier:this.props.ftEntIdentifier,instanceID:this.props.instanceID,hasEnteredText:this.hasEnteredText()});},_onMentionsInputFocus:function u(){if(!this.state.bootloaded&&!this._currentlyBootloading){this._currentlyBootloading=true;c('Bootloader').loadModules(["TypeaheadMetricReporter","getMentionsSearchSource"],function(v,w){if(!this.isMounted())return;var x=new v({event_name:'tinder_mentions'});x.sessionStart();var y=w(this.props.datasource,x,c('UFIConfig').showHashtagTypeahead);y.bootstrap();this.setState({typeaheadReporter:x,bootloaded:true,mentionsSource:y},function(){this._currentlyBootloading=false;}.bind(this));}.bind(this),'UFIMentionsInput.react');}else if(this.state.typeaheadReporter)this.state.typeaheadReporter.sessionStart();this.props.onFocus&&this.props.onFocus();c('Arbiter').inform(c('UFIUIEvents').Focus,{ftEntIdentifier:this.props.ftEntIdentifier,instanceID:this.props.instanceID});},_onShowMentions:function u(v,w){if(this.state.typeaheadReporter)this.state.typeaheadReporter.reportResults(v.map(function(x){return x.getUniqueID();}));},_onAddMention:function u(v,w,x){if(this.state.typeaheadReporter){this.state.typeaheadReporter.reportSelect(v.getUniqueID(),v.getType(),w,x.button>=0);this.state.typeaheadReporter.sessionEnd();this.state.typeaheadReporter.sessionStart();}},_onFallbackKeyDown:function u(v){if(v.which!==c('Keys').RETURN)return;if(c('isSoftNewlineEvent')(v)||!this.state.fallbackText.trim())return;v.preventDefault();var w={visibleValue:this.state.fallbackText,encodedValue:this.state.fallbackText};if(this.props.onEnterSubmit(w,v))this.setState({fallbackText:''});},_onFallbackChange:function u(v){this.setState({fallbackText:v.target.value});},_onFallbackBlur:function u(v){this.props.onBlur&&this.props.onBlur();},_onFallbackFocus:function u(v){this.props.onFocus&&this.props.onFocus();},_sortByRenderType:function u(v,w){var x=v.getAuxiliaryData().renderType,y=w.getAuxiliaryData().renderType;if(x===y)return v.getOrder()-w.getOrder();var z=this.props.viewOptionsTypeObjectsOrder;return z.indexOf(x)-z.indexOf(y);},_triggerFullRender:function u(v){this.setState({fullRender:true},v);},_triggerFullRenderWithoutCallback:function u(){this._triggerFullRender();},_renderFallback:function u(){return (c('React').createElement('div',{className:"_2xwx"},c('React').createElement('textarea',{ref:'textarea',className:"UFIAddCommentInput _1os9 _2xww",name:'add_comment_text',placeholder:this.props.placeholder,spellCheck:true,onKeyDown:this._onFallbackKeyDown,onChange:this._onFallbackChange,onBlur:this._onFallbackBlur,onFocus:this._onFallbackFocus,value:this.state.fallbackText})));},_renderProxyInput:function u(){if(!this.props.hideProxyInput){var v="_1osa mentionsHidden";return (c('React').createElement('input',{className:v,name:'add_comment_text',ref:'proxyInput',onFocus:this.focus,tabIndex:'-1'}));}},_renderDummy:function u(){var v="UFIAddCommentInput _1osb _1osc _2xww";return (c('React').createElement('div',{onClick:this._triggerFullRenderWithoutCallback,className:"_2xwx",onFocus:this._triggerFullRenderWithoutCallback,onMouseOver:this._triggerFullRenderWithoutCallback,onSelect:c('emptyFunction'),onTouchStart:this._triggerFullRenderWithoutCallback,role:'presentation'},this._renderProxyInput(),c('React').createElement('div',{className:v},this.props.placeholder)));},_onClickEditorContainer:function u(v){c('clickRefAction')('ufi',v.target,null,'FORCE');},_renderMentionsInput:function u(){var v="UFIAddCommentInput _1osb _2xww",w=babelHelpers['extends']({mentionSortFn:this.props.viewOptionsTypeObjectsOrder?this._sortByRenderType:null},this.props.viewProps);return (c('React').createElement('div',{className:"_2xwx",onClick:this._onClickEditorContainer,role:'presentation'},this._renderProxyInput(),c('React').createElement(j,{ref:'mentionsInput',className:v,editorState:this.state.editorState,onChange:this._onChange,mentionsSource:this.state.mentionsSource,typeaheadView:this.props.viewComponent,typeaheadViewProps:w,spellCheck:true,showEmojiPicker:true,placeholder:this.props.placeholder,onAddMention:this._onAddMention,onShowMentions:this._onShowMentions,onFocus:this._onMentionsInputFocus,onBlur:this._onMentionsInputBlur,handleContentReturn:this._handleContentReturn,handleBeforeInput:this._handleBeforeInput,handlePastedFiles:this._handlePastedFiles,handleDroppedFiles:this._handleDroppedFiles,autoflip:this.props.autoflip,position:this.props.isBroadcasterUFI?'above':null,webDriverTestID:this.props.replyCommentID?n:m})));},componentDidMount:function u(){if(!o){if(this.state.fallbackText)c('ReactDOM').findDOMNode(this.refs.textarea).focus();}else if(this.state.editorState.getCurrentContent().hasText())c('setImmediate')(function(){this.isMounted()&&this.focus();}.bind(this));},render:function u(){if(!o)return this._renderFallback();if(!this.state.fullRender)return this._renderDummy();return this._renderMentionsInput();}});function t(u){return c('DraftEntity').create('MENTION','IMMUTABLE',{id:u.uid,isWeak:u.weakreference});}f.exports=s;}),null);