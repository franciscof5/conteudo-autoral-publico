"use strict";String.prototype.endsWith||(String.prototype.endsWith=function(e,n){return n<this.length?n|=0:n=this.length,this.substr(n-e.length,e.length)===e});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,n){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?n():"function"==typeof define&&define.amd?define(n):n()}(0,function(){function e(n){var t=this.constructor;return this.then(function(e){return t.resolve(n()).then(function(){return e})},function(e){return t.resolve(n()).then(function(){return t.reject(e)})})}var n=setTimeout;function o(){}function r(e){if(!(this instanceof r))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],l(e,this)}function i(t,o){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,r._immediateFn(function(){var e=1===t._state?o.onFulfilled:o.onRejected;if(null!==e){var n;try{n=e(t._value)}catch(e){return void u(o.promise,e)}a(o.promise,n)}else(1===t._state?a:u)(o.promise,t._value)})):t._deferreds.push(o)}function a(n,e){try{if(e===n)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"===(void 0===e?"undefined":_typeof(e))||"function"==typeof e)){var t=e.then;if(e instanceof r)return n._state=3,n._value=e,void c(n);if("function"==typeof t)return void l((o=t,i=e,function(){o.apply(i,arguments)}),n)}n._state=1,n._value=e,c(n)}catch(e){u(n,e)}var o,i}function u(e,n){e._state=2,e._value=n,c(e)}function c(e){2===e._state&&0===e._deferreds.length&&r._immediateFn(function(){e._handled||r._unhandledRejectionFn(e._value)});for(var n=0,t=e._deferreds.length;n<t;n++)i(e,e._deferreds[n]);e._deferreds=null}function s(e,n,t){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof n?n:null,this.promise=t}function l(e,n){var t=!1;try{e(function(e){t||(t=!0,a(n,e))},function(e){t||(t=!0,u(n,e))})}catch(e){if(t)return;t=!0,u(n,e)}}r.prototype.catch=function(e){return this.then(null,e)},r.prototype.then=function(e,n){var t=new this.constructor(o);return i(this,new s(e,n,t)),t},r.prototype.finally=e,r.all=function(n){return new r(function(o,i){if(!n||void 0===n.length)throw new TypeError("Promise.all accepts an array");var r=Array.prototype.slice.call(n);if(0===r.length)return o([]);var a=r.length;function u(n,e){try{if(e&&("object"===(void 0===e?"undefined":_typeof(e))||"function"==typeof e)){var t=e.then;if("function"==typeof t)return void t.call(e,function(e){u(n,e)},i)}r[n]=e,0==--a&&o(r)}catch(e){i(e)}}for(var e=0;e<r.length;e++)u(e,r[e])})},r.resolve=function(n){return n&&"object"===(void 0===n?"undefined":_typeof(n))&&n.constructor===r?n:new r(function(e){e(n)})},r.reject=function(t){return new r(function(e,n){n(t)})},r.race=function(i){return new r(function(e,n){for(var t=0,o=i.length;t<o;t++)i[t].then(e,n)})},r._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){n(e,0)},r._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var t=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();"Promise"in t?t.Promise.prototype.finally||(t.Promise.prototype.finally=e):t.Promise=r});_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,n){(e.ESWG_INIT=e.ESWG_INIT||[]).push(function(e){e.Ajax=function(){function i(e){return e||null}function r(e,n,t,o){var i,r,a=["then","catch","always"].reduce(function(n,t){return n[t]=function(e){return n[t]=e,n},n},{}),u=new XMLHttpRequest,c=function(e,n,t){if("get"!==t.toLowerCase()||!n)return e;var o=l(n),i=-1<e.indexOf("?")?"&":"?";return e+i+o}(n,t,e);return u.open(e,c,!0),u.withCredentials=o.hasOwnProperty("withCredentials"),function(n,t){e=t=t||{},Object.keys(e).some(function(e){return"content-type"===e.toLowerCase()})||(t["Content-Type"]="application/x-www-form-urlencoded");var e;Object.keys(t).forEach(function(e){t[e]&&n.setRequestHeader(e,t[e])})}(u,o.headers),u.addEventListener("readystatechange",(i=a,r=u,function e(){r.readyState===r.DONE&&(r.removeEventListener("readystatechange",e,!1),i.always.apply(i,s(r)),200<=r.status&&r.status<300?i.then.apply(i,s(r)):i.catch.apply(i,s(r)))}),!1),u.send(l(t)),a.abort=function(){return u.abort()},a}function s(n){var t;try{t=JSON.parse(n.responseText)}catch(e){t=n.responseText}return[t,n]}function l(e){return n=e,"[object Object]"===Object.prototype.toString.call(n)?function e(n,t){t=t||!1;var o=[];for(var i in n)n.hasOwnProperty(i)&&("object"==_typeof(n[i])?o.push(e(n[i],i)):(!1===n[i]&&console.log(),o.push(encodeURIComponent(t?t+"["+i+"]":i)+"="+encodeURIComponent("boolean"==typeof n[i]?n[i]?1:"":n[i]))));return o.join("&")}(e):e;var n}return function(o){if((o=o||{}).baseUrl=o.baseUrl||"",o.method&&o.url)return r(o.method,o.baseUrl+o.url,i(o.data),o);return["get","post","put","delete"].reduce(function(e,t){return e[t]=function(e,n){return r(t,o.baseUrl+e,i(n),o)},e},{})}}()})}(window);var _createClass=function(){function o(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,n,t){return n&&o(e.prototype,n),t&&o(e,t),e}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}!function(l){var n=function(){function e(){_classCallCheck(this,e),this._callSWG()}return _createClass(e,[{key:"_callSWG",value:function(){var e=document.createElement("script");e.type="text/javascript",e.src="https://news.google.com/swg/js/v1/swg.js",e.id="google-swg-script";var n=document.querySelector("head");n.insertBefore(e,n.childNodes[0])}},{key:"getCookie",value:function(e){var n,t,o,i=document.cookie.split(";");for(n=0;n<i.length;n++)if(t=i[n].substr(0,i[n].indexOf("=")),o=i[n].substr(i[n].indexOf("=")+1),(t=t.replace(/^\s+|\s+$/g,""))===e)return decodeURIComponent(o)}},{key:"setCookie",value:function(e,n,t){for(var o=document.domain.split(".");3<o.length;)o.shift();o=o.join(".");var i=new Date;i.setDate(i.getDate()+t);var r=encodeURIComponent(n)+(null==t?"":"; expires="+i.toUTCString());document.cookie=e+"="+r+"; domain=."+o+"; path=/"}},{key:"getSubscription",value:function(e){var n=e.packageName,o=void 0===n?"com.fett.android.estadao":n,t=e.productId,i=void 0===t?null:t,r=e.purchaseToken,a=void 0===r?null:r;return new Promise(function(t,n){(l.ESWG=l.ESWG||[]).push(function(e){e.Ajax({headers:{Accept:"application/json"}}).post("https://assine.estadao.com.br/api/google/subscribe/consult",{productId:i,packageName:o,purchaseToken:a}).then(function(e,n){t(e)}).catch(function(e){n({result:!1}),console.error(e)})})})}},{key:"accountPaywallFlow",value:function(e){var n=e.isAssinante,o=void 0!==n&&n,t=e.estadaoToken,i=void 0===t?"":t,s=this;(l.SWG=l.SWG||[]).push(function(c){c.setOnEntitlementsResponse(function(e){e.then(function(u){var e=new Promise(function(n){(l.ESWG=l.ESWG||[]).push(function(e){e.GClient.auth2().then(function(e){n(e)})})});if(o){if(!s.getCookie("ESWG_SAVE")&&!u.enablesThis()&&i){var n=new Promise(function(e){e({token:btoa(i)})});c.saveSubscription(function(){return n}).then(function(){s.setCookie("ESWG_SAVE",1,7)})}}else if(u.enablesThis()){var t=JSON.parse(u.getEntitlementForThis().json().subscriptionToken);"estadao"===t.access_type?s.getCookie("ESWG_LOGIN")||c.showLoginPrompt().then(function(){(l.ESWG=l.ESWG||[]).push(function(e){c.waitForSubscriptionLookup(e.SingIn.loginWithEstadaoAuthToken(t.auth)).then(function(e){e.result&&window.location.reload()})})},function(e){s.setCookie("ESWG_LOGIN",1)}):e.then(function(r){var a=function(a){return new Promise(function(r){(l.ESWG=l.ESWG||[]).push(function(e){var n=a.currentUser.get(),t=n.getBasicProfile(),o=n.getAuthResponse().access_token,i=JSON.parse(u.getEntitlementForThis().json().subscriptionToken);e.Order.submit(i,{id:t.getId(),name:t.getName(),givenName:t.getGivenName(),familyName:t.getFamilyName(),imageUrl:t.getImageUrl(),email:t.getEmail(),access_token:o},o,"submitOrderLogin").then(function(e){r(e)})})})};new Promise(function(o,i){var n=function(n,t){n?(l.ESWG=l.ESWG||[]).push(function(e){e.SingIn.accountCheckById(n).then(function(e){t&&e.result?(c.waitForSubscriptionLookup(a(r)).then(function(e){e.result&&window.location.reload()}),i(!1)):o(e.result)})}):o(!1)},e=r.currentUser.get().getId();null===e?s.getSubscription(t).then(function(e){e.result&&(e.data.profileId?c.showLoginPrompt().then(function(){r.signIn().then(function(){c.showLoginNotification().then(function(){n(r.currentUser.get().getId(),!0)})})},function(e){i(!1)}):o(!1))}):n(e)}).then(function(e){e?s.getCookie("ESWG_LOGIN")||c.showLoginPrompt().then(function(){c.waitForSubscriptionLookup(a(r)).then(function(e){e.result&&window.location.reload()})},function(e){s.setCookie("ESWG_LOGIN",1)}):c.completeDeferredAccountCreation({entitlements:u,consent:!0}).then(function(n){var t=JSON.parse(n.purchaseData.json().data),o=n.userData;(l.ESWG=l.ESWG||[]).push(function(e){e.Order.submit(t,{id:o.id,name:o.name,givenName:o.givenName,familyName:o.familyName,imageUrl:o.pictureUrl,email:o.email,idToken:o.idToken},null,"completeDeferredAccountCreation").then(function(){n.complete().then(function(){window.location.reload()})})})})})})}})})})}}]),e}();(l.ESWG_INIT=l.ESWG_INIT||[]).push(function(e){e.Subscription=new n})}(window);_createClass=function(){function o(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,n,t){return n&&o(e.prototype,n),t&&o(e,t),e}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}!function(n){var t=function(){function e(){_classCallCheck(this,e),this.inited=!1,this.pushList=[],this.clientID="320168471681-8oru1jt5jcvkdlsonmnsbj5jnp4k3gfa.apps.googleusercontent.com",this._callGoogleClient()}return _createClass(e,[{key:"init",value:function(){for(var e in this.inited=!0,this.pushList)this.push(this.pushList[e])}},{key:"push",value:function(e){this.inited?e(this):this.pushList.push(e)}},{key:"_callGoogleClient",value:function(){var e=document.createElement("script");e.type="text/javascript",e.src="https://apis.google.com/js/client:platform.js?onload=ESWGGoogleClientInit",e.id="google-client-script";var n=document.querySelector("head");n.insertBefore(e,n.childNodes[0])}},{key:"auth2",value:function(){var e=this;return new Promise(function(n){e.push(function(){gapi.load("auth2",function(){gapi.auth2.init({client_id:e.clientID,scope:"https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email"}).then(function(e){n(e)})})})})}}]),e}();(n.ESWG_INIT=n.ESWG_INIT||[]).push(function(e){n.ESWGGoogleClientInit=function(){e.GClient.init()},e.GClient=new t})}(window);_createClass=function(){function o(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,n,t){return n&&o(e.prototype,n),t&&o(e,t),e}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}!function(e){var n=function(){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;_classCallCheck(this,n),this.inited=!1,this.GClient=e,this.pushList=[],this.googleyolo=null,this.clientID=e.clientID}return _createClass(n,[{key:"init",value:function(e){for(var n in this.googleyolo=e,this.inited=!0,this.pushList)this.push(this.pushList[n])}},{key:"push",value:function(e){this.inited?e(this):this.pushList.push(e)}},{key:"_callClient",value:function(){var e=document.createElement("script");e.type="text/javascript",e.src="https://smartlock.google.com/client",e.id="google-singin-client-script";var n=document.querySelector("head");n.insertBefore(e,n.childNodes[0])}},{key:"accountCheckById",value:function(n){return new Promise(function(t){(e.ESWG=e.ESWG||[]).push(function(e){e.Ajax({headers:{Accept:"application/json"}}).post("https://assine.estadao.com.br/api/google/subscribe/account-check",{id:n}).then(function(e,n){t(e)}).catch(function(e){t({result:!1}),console.error(e)})})})}},{key:"loginByAccessToken",value:function(n){return new Promise(function(t){(e.ESWG=e.ESWG||[]).push(function(e){e.Ajax({headers:{Accept:"application/json"},withCredentials:!0}).post("https://assine.estadao.com.br/api/google/subscribe/login",{access_token:n}).then(function(e,n){t(e)}).catch(function(e){t({result:!1}),console.error(e)})})})}},{key:"loginWithEstadaoAuthToken",value:function(n){return new Promise(function(t){(e.ESWG=e.ESWG||[]).push(function(e){e.Ajax({headers:{Accept:"application/json"},withCredentials:!0}).post("https://assine.estadao.com.br/api/google/subscribe/login-with-estadao-token",{auth_token:n}).then(function(e,n){t(e)}).catch(function(e){t({result:!1}),console.error(e)})})})}},{key:"automatically",value:function(){var o=this;return new Promise(function(t){o.push(function(e){var n=arguments;e.googleyolo.hint({supportedAuthMethods:["https://accounts.google.com"],supportedIdTokenProviders:[{uri:"https://accounts.google.com",clientId:o.clientID}]}).then(function(){t(n)})})})}}]),n}();e.onGoogleYoloLoad=function(n){(e.ESWG_INIT=e.ESWG_INIT||[]).push(function(e){e.SingIn.init(n)})},(e.ESWG_INIT=e.ESWG_INIT||[]).push(function(e){e.SingIn=new n(e.GClient)})}(window);_createClass=function(){function o(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,n,t){return n&&o(e.prototype,n),t&&o(e,t),e}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}!function(i){var n=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"submit",value:function(e,n,t,o){return this.send({orderData:{orderId:e.orderId||null,packageName:e.packageName||null,productId:e.productId||null,purchaseTime:e.purchaseTime||null,purchaseState:e.purchaseState||null,purchaseToken:e.purchaseToken||null,autoRenewing:e.autoRenewing||null},userGoogleData:{id:n.id||null,name:n.name||null,givenName:n.givenName||null,familyName:n.familyName||null,imageUrl:n.imageUrl||null,email:n.email||null,idToken:n.idToken||null,access_token:t||null},origin:o||"store"})}},{key:"send",value:function(o){return new Promise(function(t,n){(i.ESWG=i.ESWG||[]).push(function(e){e.Ajax({headers:{Accept:"application/json"},withCredentials:!0}).post("https://assine.estadao.com.br/api/google/subscribe/store",o).then(function(e,n){t(e)}).catch(function(e){console.error(e),n({result:!1})})})})}}]),e}();(i.ESWG_INIT=i.ESWG_INIT||[]).push(function(e){e.Order=new n})}(window);_createClass=function(){function o(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,n,t){return n&&o(e.prototype,n),t&&o(e,t),e}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}!function(i){var n=function(){function e(){_classCallCheck(this,e),this.iframe=null,this.createButton()}return _createClass(e,[{key:"createButton",value:function(){(i.SWG=i.SWG||[]).push(function(e){var n=document.querySelectorAll('.assine-swg-button[data-product]:not([data-append="1"])');for(var t in n)if(n.hasOwnProperty(t)&&n[t].getAttribute("data-product")){var o=n[t];o.setAttribute("data-append",1),o.appendChild(e.createButton(function(){var n=this;(i.ESWG=i.ESWG||[]).push(function(e){e.open(n.closest("[data-product]").getAttribute("data-product"))})}))}})}},{key:"showIframeHtml",value:function(n){var t=this;return new Promise(function(e){if(t.iframe)return t.iframe.contentWindow.document.write(n),void e(t.iframe);t.iframe=document.createElement("iframe"),t.iframe.setAttribute("srcdoc",""),t.iframe.setAttribute("id","google-subscribe-request-user-data"),t.iframe.style.display="none",document.documentElement.appendChild(t.iframe),t.iframe.onload=function(){t.iframe.contentWindow.document.write(n),t.iframe.contentWindow.CMD=t.iframe.contentWindow.CMD||[],t.iframe.contentWindow.CMD.push(function(){e(t.iframe)})}})}}]),e}();(i.ESWG_INIT=i.ESWG_INIT||[]).push(function(e){e.Template=new n})}(window);_createClass=function(){function o(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,n,t){return n&&o(e.prototype,n),t&&o(e,t),e}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}!function(e){var n=function(){function e(){_classCallCheck(this,e),this.events={},this.count=0}return _createClass(e,[{key:"dispatchEvent",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};for(var t in window.parent&&window.parent.postMessage(JSON.stringify({google_swg_event:{name:e,params:JSON.stringify(n)}}),"*"),this.events)-1<t.indexOf("["+e+"]")&&"function"==typeof this.events[t]&&this.events[t](n)}},{key:"addEventListener",value:function(e,n){e=this.count+"["+e+"]",this.events[e]=n,this.count++}}]),e}();(e.ESWG_INIT=e.ESWG_INIT||[]).push(function(e){e.Event=new n,e.Event.dispatchEvent("init")})}(window);_createClass=function(){function o(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,n,t){return n&&o(e.prototype,n),t&&o(e,t),e}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}!function(i){var e=function(){function o(e,n){for(var t in _classCallCheck(this,o),e)this.push(e[t]);for(var t in n)this.push(n[t])}return _createClass(o,[{key:"push",value:function(e){e(this)}},{key:"checkAuth",value:function(){this.Auth.check().then(function(e){})}},{key:"reSendOrder",value:function(){var o=this;return new Promise(function(t,e){(i.SWG=i.SWG||[]).push(function(e){e.setOnEntitlementsResponse(function(e){e.then(function(e){var n=JSON.parse(e.getEntitlementForThis().json().subscriptionToken);t(o.Order.submit(n,{},null))})})})})}},{key:"open",value:function(n){(i.ESWG=i.ESWG||[]).push(function(a){a.Event.dispatchEvent("open",{productID:n}),(i.SWG=i.SWG||[]).push(function(e){e.setOnSubscribeResponse(function(e){e.then(function(i){var r=0;!function n(){var e=i,t=JSON.parse(e.purchaseData.json().data),o=e.userData;r++,a.Event.dispatchEvent("submitOrder",o);try{a.Order.submit(t,{id:o.id,name:o.name,givenName:o.givenName,familyName:o.familyName,imageUrl:o.pictureUrl,idToken:o.idToken,email:o.email},null).then(function(e){e.result?(a.Event.dispatchEvent("completeOrder",e),e.html&&(e.document?a.Event.dispatchEvent("successDocument",e):a.Event.dispatchEvent("success",e)),i.complete(),a.Template.showIframeHtml(e.html).then(function(e){e.style.display="inline-block",e.style.width="100%",e.style.height="100%",e.style.border="none",e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.background="rgba(0,0,0,0.5)",e.style.zIndex="99999999"})):r<=3&&setTimeout(function(){n()},500)}).catch(function(){n()})}catch(e){n()}}()}).catch(function(){a.Event.dispatchEvent("cancel",n)})}),e.subscribe(n)})})}}]),o}();i.ESWG=new e(i.ESWG_INIT||[],i.ESWG||[]),i.ESWG_INIT&&delete i.ESWG_INIT}(window);